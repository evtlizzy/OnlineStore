# OnlineStore
MEPHI third semester task: creating a database for an online shop(creating an ERD, exploring according to normalisation theory, filling tables, creating queries, triggers, views and functions, modifying the reference project to suit my tables and improving unrealised methods)

## Subject domain
Описание элементов интернет-магазина. 

Включает в себя: категории товаров, товары, клиентов, заказы. 

Описание категории товаров состоит из: названия и позиции в дереве категорий. 

Описание товара состоит из: названия, краткого описания, полного описания, списка идентификаторов 
изображений, базовой цены, текущей цены, количества на складе, артикля, 
списка цветов, списка размеров, минимального количества в одном заказе. 

Описание клиента состоит из: имени, телефона, адреса, email-а. 

Описание заказа состоит из: указания клиента, номера заказа, способа оплаты, способа 
доставки, списка товаров, стоимости товаров на момент заказа, общей 
стоимости заказа с учётом доставки, даты заказа.

Товар может относиться к нескольким категориям. Заказ не содержит 
информацию о размере и цвете товара.

## Task 1
Создание диаграммы согласно заданной предметной области.

## Task 2
Общая часть задания:

1. В соответствии с разработанной схемой БД 
реализуйте на языке набор таблиц для СУБД PostgreSQL, предусмотрев все 
возможные (по смыслу) ограничения целостности.
2. Исследуйте созданные таблицы на нахождение в 1НФ, 2НФ, 3НФ, 
НФБК. Если таблицы не находятся в какой-либо из указанных форм, то 
декомпозируйте их и повторите исследование заново. Напишите SQL-скрипт 
для создания таблиц в соответствии с новой схемой, предусмотрев все 
возможные (по смыслу) ограничения целостности. 
3. Заполните все таблицы не менее, чем 5-ю осмысленными записями. 
Данные возьмите из аналогичныx систем в реальной жизни. Заполнение 
оформите в виде SQL-запросов.
4. Для созданных таблиц напишите на языке SQL запросы, указанные 
далее по вариантам.

Запросы:

0. Выберите суммарную стоимость всех товаров интернет магазина с 
учётом их количества.
1. Выберите среднее число заказов для всех клиентов (отношение общего 
числа заказов к общему числу клиентов).
2. Выберите одним запросом самый маленький и самый большой по 
количеству товаров заказы.
3. Удалите все категории товаров, у которых нет товаров прямых потомков 
в дереве или товаров косвенных потомков второго уровня
(предварительно добавьте каскадную замену на NULL в ссылках на 
категорию из категорий).
4. Добавьте ко всем товарам, содержащим в названии слово «сарафан», в 
список цветов жёлтый цвет, если его нет.
5. Добавьте в базу данных новую информацию о клиенте: скидка, со 
значением по умолчанию 0%.
6. Добавьте ограничение целостности, не позволяющие делать скидку 
больше 75%

## Task 3
Общая часть задания:

1. Для разработанной базы данных создайте триггер, контролирующий 
указанное в задании 0 вашего варианта условие.
2. Для разработанной базы данных напишите функцию, вычисляющую 
указанную в задании 1 вашего варианта информацию.
3. Для разработанной базы данных напишите агрегатную функцию, 
вычисляющую указанную в задании 2 вашего варианта информацию.
4. Для разработанной базы данных создайте представление и триггер, 
реализующие указанное в задании 3 вашего варианта условие.
5. Решите указанную в пункте 4 вашего варианта задачу.

Задания:

0. Триггер не позволяет добавлять каталоги более чем третьего уровня 
вложенности.
1. По указанному артиклю товара, возвращает общую стоимость всех 
заказов, включающих данный товар.
2. Для множества идентификаторов товаров, вычислить количество 
товаров, заказанных хотя бы один раз.
3. Создайте представление, отображающее названия товаров, артикли и 
количество товаров в наличии (и ключевые поля таблицы товары). 
Реализуйте возможность изменения количества товаров через это 
представление в реальной таблице.
4. При помощи таблицы и набора процедур (или функций) реализуйте 
структуру представления данных «Однонаправленная очередь». 
Структура должна позволять сохранять в очередь строки, длиной не 
более 64 символов. Должны быть доступны действия enqueue –
добавление элемента в конец очередь, dequeue – удаление элемента из 
начала очереди, empty – очистка очереди, init – инициализация 
очереди, top – просмотр начала очереди, tail – просмотр конца очереди

## Task 4
Общая часть задания:

изучение основ работы с базами данных из языков высокого уровня 
на примере Python.

1. Загрузите эталонный проект и настройте его для ваших сервера и 
пользователя СУБД, а также установите нужные библиотеки для языка 
Python.
2. Замените базовые таблицы people и phone в проекте на указанные в 
вашем варианте.
3. Доделате для первой таблицы возможности удаления сущностей.
4. Доделайте для второй таблицы просмотр списка сущностей по 
указанному значению ключа из первой таблицы, добавление новых 
сущностей с этим ключом, удаление сущностей.
5. Устраните все потенциальные SQL-injection уязвимости.

Вариант: Таблицы товары (без привязки к категории и спискам цветов и размеров) и 
список идентификаторов изображений без связей с другими таблицами.
